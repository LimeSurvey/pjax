{"version":3,"file":"pjax.js","sources":["../src/lib/polyfills/Array.prototype.from.js","../src/lib/utility.js","../src/lib/events/on.js","../src/lib/ConsoleShim.js","../src/lib/proto/log.js","../src/lib/events/trigger.js","../src/lib/request.js","../src/lib/switches.js","../src/lib/switches-selectors.js","../src/lib/polyfills/Function.prototype.bind.js","../src/lib/proto/attach-link.js","../src/lib/proto/attach-form.js","../node_modules/promise-polyfill/promise.js","../src/lib/eval-script.js","../src/lib/execute-scripts.js","../src/lib/events/off.js","../src/lib/proto/unattach-link.js","../src/lib/proto/unattach-form.js","../src/lib/update-stylesheets.js","../src/lib/proto/parsers.js","../src/lib/domutil.js","../src/index.js"],"sourcesContent":["if(!Array.prototype.from){\r\n    Array.prototype.from = function(enumerable){\r\n        var arr = [];\r\n        for(var i = enumerable.length; i--; arr.unshift(enumerable[i]));\r\n        return arr;\r\n    };\r\n}","/**\r\n * General utility file \r\n * Exports: \r\n * -> forEachEls\r\n * -> getElements\r\n * -> clone\r\n * -> isSupported\r\n * -> newUid\r\n */\r\nimport './polyfills/Array.prototype.from';\r\n\r\nexport const forEachEls = \r\nfunction (els, fn, ctx) {\r\n  if (els instanceof HTMLCollection || els instanceof NodeList || els instanceof Array) {\r\n    return Array.prototype.from(els).forEach((el, i) => fn.call(ctx, el, i));\r\n  }\r\n  // assume simple dom element\r\n  return fn.call(ctx, els);\r\n};\r\n\r\nexport const getElements = function (el) {\r\n  return el.querySelectorAll(this.options.elements);\r\n};\r\n\r\nexport const clone = function (obj) {\r\n  if (null === obj || \"object\" != typeof obj) {\r\n    return obj;\r\n  }\r\n  const copy = obj.constructor();\r\n  for (var attr in obj) {\r\n    if (attr in obj) {\r\n      copy[attr] = obj[attr];\r\n    }\r\n  }\r\n  return copy;\r\n};\r\n\r\nexport const isSupported = function () {\r\n  // Borrowed wholesale from https://github.com/defunkt/jquery-pjax\r\n  return window.history &&\r\n    window.history.pushState &&\r\n    window.history.replaceState &&\r\n    // pushState isnâ€™t reliable on iOS until 5.\r\n    !navigator.userAgent.match(/((iPod|iPhone|iPad).+\\bOS\\s+[1-4]\\D|WebApps\\/.+CFNetwork)/);\r\n};\r\n\r\nexport const newUid = (function() {\r\n    var counter = 0;\r\n    return function() {\r\n      var id = (\"pjax\" + (new Date().getTime())) + \"_\" + counter;\r\n      counter++;\r\n      return id;\r\n    };\r\n  })();\r\n\r\nexport default function() {\r\n    return {\r\n        forEachEls,\r\n        getElements,\r\n        clone,\r\n        isSupported,\r\n        newUid\r\n    };\r\n}","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, listener, useCapture) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events);\r\n\r\n  events.forEach(function(e) {\r\n    forEachEls(els, function(el) {\r\n      el.addEventListener(e, listener, useCapture);\r\n    });\r\n  });\r\n}\r\n","/* eslint no-console: \"off\" */\nclass ConsoleShim {\n    constructor(param='', silencer=false) {\n\n        this.param = param;\n        this.silencer = silencer;\n        this.collector = [];\n        this.currentGroupDescription = '';\n        this.activeGroups = 0;\n        this.timeHolder = null;\n        this.methods = [\n            'group', 'groupEnd', 'log', 'trace', 'time', 'timeEnd', 'error', 'warn'\n        ];\n\n        this.silent = {\n            group : ()=>{return;},\n            groupEnd : ()=>{return;},\n            log : ()=>{return;},\n            trace : ()=>{return;},\n            time : ()=>{return;},\n            timeEnd : ()=>{return;},\n            error : ()=>{return;},\n            err : ()=>{return;},\n            debug : ()=>{return;},\n            warn : ()=>{return;}\n        };\n    }\n\n    _generateError() {\n        try {\n            throw new Error();\n        } catch (err) {\n            return err;\n        }\n    }\n\n    _insertParamToArguments(rawArgs){\n        if(this.param !== ''){\n            let args = [...rawArgs];\n            args.unshift(this.param);\n            return args;\n        }\n        return Array.from(arguments);\n    }\n\n    setSilent(newValue = null){\n        this.silencer = newValue || !this.silencer;\n    }\n    //Start grouping logs\n    group() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.group === 'function') {\n            console.group.apply(console, args);\n            return;\n        }\n        const description = args[0] || 'GROUP';\n        this.currentGroupDescription = description;\n        this.activeGroups++;\n    }\n    //Stop grouping logs\n    groupEnd() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.groupEnd === 'function') {\n            console.groupEnd.apply(console, args);\n            return;\n        }\n        this.currentGroupDescription = '';\n        this.activeGroups--;\n        this.activeGroups = this.activeGroups === 0 ? 0 : this.activeGroups--;\n    }\n    //Simplest mechanism to log stuff\n    // Aware of the group shim\n    log() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.group === 'function') {\n            console.log.apply(console, args);\n            return;\n        }\n        args.shift();\n        args.unshift(' '.repeat(this.activeGroups * 2));\n        this.log.apply(this,args);\n    }\n    //Trace back the apply.\n    //Uses either the inbuilt function console trace or opens a shim to trace by calling this._insertParamToArguments(arguments).callee\n    trace() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);        \n        if (typeof console.trace === 'function') {\n            console.trace.apply(console, args);\n            return;\n        }\n        const artificialError = this._generateError();\n        if (artificialError.stack) {\n            this.log.apply(console, artificialError.stack);\n            return;\n        }\n\n        this.log.log(args);\n        if (arguments.callee != undefined) {\n            this.trace.apply(console, arguments.callee);\n        }\n    }\n\n    time() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);    \n        if (typeof console.time === 'function') {\n            console.time.apply(console, args);\n            return;\n        }\n\n        this.timeHolder = new Date();\n    }\n\n    timeEnd() {\n        if(this.silencer) { return; }\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.timeEnd === 'function') {\n            console.timeEnd.apply(console, args);\n            return;\n        }\n        const diff = (new Date()) - this.timeHolder;\n        this.log.log(`Took ${Math.floor(diff/(1000*60*60))} hours, ${Math.floor(diff/(1000*60))} minutes and ${Math.floor(diff/(1000))} seconds ( ${diff} ms)`);\n        this.time = new Date();\n    }\n\n    error() {\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.error === 'function') {\n            console.error.apply(console,args);\n            return;\n        }\n\n        this.log.log('--- ERROR ---');\n        this.log.log(args);\n    }\n\n\n    warn() {\n        const args = this._insertParamToArguments(arguments);\n        if (typeof console.warn === 'function') {\n            console.warn.apply(console,args);\n            return;\n        }\n\n        this.log.log('--- WARN ---');\n        this.log.log(args);\n    }\n}\n\nexport default ConsoleShim;","import ConsoleShim from '../ConsoleShim';\r\n\r\nexport default function () {\r\n    console.log(\"PJAX options\", this.options);\r\n    this.options.logObject = new ConsoleShim('PJAX ->', !this.options.debug);    \r\n    return this.options.logObject;\r\n  }\r\n\r\n","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, opts) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events);\r\n\r\n  events.forEach(function(e) {\r\n    var event; // = new CustomEvent(e) // doesn't everywhere yet\r\n    event = document.createEvent(\"HTMLEvents\");\r\n    event.initEvent(e, true, true);\r\n    event.eventName = e;\r\n    if (opts) {\r\n      Object.keys(opts).forEach(function(key) {\r\n        event[key] = opts[key];\r\n      });\r\n    }\r\n\r\n    forEachEls(els, function(el) {\r\n      var domFix = false;\r\n      if (!el.parentNode && el !== document && el !== window) {\r\n        // THANKS YOU IE (9/10//11 concerned)\r\n        // dispatchEvent doesn't work if element is not in the dom\r\n        domFix = true;\r\n        document.body.appendChild(el);\r\n      }\r\n      el.dispatchEvent(event);\r\n      if (domFix) {\r\n        el.parentNode.removeChild(el);\r\n      }\r\n    });\r\n  });\r\n}\r\n","export default function(location, options, callback) {\r\n  options = options || {};\r\n  const requestMethod = options.requestMethod || \"GET\";\r\n  const requestPayload = options.requestPayloadString || null;\r\n  const request = new XMLHttpRequest();\r\n\r\n  request.onreadystatechange = function() {\r\n    if (request.readyState === 4) {\r\n      if (request.status === 200) {\r\n        callback(request.responseText, request);\r\n      }\r\n      else {\r\n        callback(null, request);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Add a timestamp as part of the query string if cache busting is enabled\r\n  if (this.options.cacheBust) {\r\n    location += (!/[?&]/.test(location) ? \"?\" : \"&\") + new Date().getTime();\r\n  }\r\n\r\n  request.open(requestMethod.toUpperCase(), location, true);\r\n  request.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n  // Add the request payload if available\r\n  if (options.requestPayloadString != undefined && options.requestPayloadString != \"\") {\r\n    // Send the proper header information along with the request\r\n    request.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n  }\r\n\r\n  request.send(requestPayload);\r\n\r\n  return request;\r\n}\r\n","import on from \"./events/on\";\r\nimport './polyfills/Array.prototype.from';\r\n// var off = require(\"./lib/events/on.js\")\r\n// var trigger = require(\"./lib/events/trigger.js\")\r\n\r\n\r\nexport default {\r\n  outerHTML: function(oldEl, newEl) {\r\n    oldEl.outerHTML = newEl.outerHTML;\r\n    this.onSwitch();\r\n  },\r\n\r\n  innerHTML: function(oldEl, newEl) {\r\n    oldEl.innerHTML = newEl.innerHTML;\r\n    oldEl.className = newEl.className;\r\n    this.onSwitch();\r\n  },\r\n\r\n  sideBySide: function(oldEl, newEl, options, switchOptions) {\r\n    let elsToRemove = [];\r\n    let elsToAdd = [];\r\n    const fragToAppend = document.createDocumentFragment();\r\n\r\n    // height transition are shitty on safari\r\n    // so commented for now (until I found something ?)\r\n    // var relevantHeight = 0\r\n    const animationEventNames = \"animationend webkitAnimationEnd MSAnimationEnd oanimationend\";\r\n    let animatedElsNumber = 0;\r\n\r\n    const sexyAnimationEnd = function(e) {\r\n          if (e.target != e.currentTarget) {\r\n            // end triggered by an animation on a child\r\n            return;\r\n          }\r\n\r\n          animatedElsNumber--;\r\n          if (animatedElsNumber <= 0 && elsToRemove) {\r\n            elsToRemove.forEach(function(el) {\r\n              // browsing quickly can make the el\r\n              // already removed by last page update ?\r\n              if (el.parentNode) {\r\n                el.parentNode.removeChild(el);\r\n              }\r\n            });\r\n\r\n            elsToAdd.forEach(function(el) {\r\n              el.className = el.className.replace(el.getAttribute(\"data-pjax-classes\"), \"\");\r\n              el.removeAttribute(\"data-pjax-classes\");\r\n              // Pjax.off(el, animationEventNames, sexyAnimationEnd, true)\r\n            });\r\n\r\n            elsToAdd = null; // free memory\r\n            elsToRemove = null; // free memory\r\n\r\n            // assume the height is now useless (avoid bug since there is overflow hidden on the parent)\r\n            // oldEl.style.height = \"auto\"\r\n\r\n            // this is to trigger some repaint (example: picturefill)\r\n            this.onSwitch();\r\n            // Pjax.trigger(window, \"scroll\")\r\n          }\r\n        }.bind(this);\r\n\r\n    // Force height to be able to trigger css animation\r\n    // here we get the relevant height\r\n    // oldEl.parentNode.appendChild(newEl)\r\n    // relevantHeight = newEl.getBoundingClientRect().height\r\n    // oldEl.parentNode.removeChild(newEl)\r\n    // oldEl.style.height = oldEl.getBoundingClientRect().height + \"px\"\r\n\r\n    switchOptions = switchOptions || {};\r\n\r\n    Array.from(oldEl.childNodes).forEach((el) => {\r\n      elsToRemove.push(el);\r\n      if (el.classList && !el.classList.contains(\"js-Pjax-remove\")) {\r\n        // for fast switch, clean element that just have been added, & not cleaned yet.\r\n        if (el.hasAttribute(\"data-pjax-classes\")) {\r\n          el.className = el.className.replace(el.getAttribute(\"data-pjax-classes\"), \"\");\r\n          el.removeAttribute(\"data-pjax-classes\");\r\n        }\r\n        el.classList.add(\"js-Pjax-remove\");\r\n        if (switchOptions.callbacks && switchOptions.callbacks.removeElement) {\r\n          switchOptions.callbacks.removeElement(el);\r\n        }\r\n        if (switchOptions.classNames) {\r\n          el.className += \" \" + switchOptions.classNames.remove + \" \" + (options.backward ? switchOptions.classNames.backward : switchOptions.classNames.forward);\r\n        }\r\n        animatedElsNumber++;\r\n        on(el, animationEventNames, sexyAnimationEnd, true);\r\n      }\r\n    });\r\n\r\n    Array.from(newEl.childNodes).forEach((el) => {\r\n      if (el.classList) {\r\n        var addClasses = \"\";\r\n        if (switchOptions.classNames) {\r\n          addClasses = \" js-Pjax-add \" + switchOptions.classNames.add + \" \" + (options.backward ? switchOptions.classNames.forward : switchOptions.classNames.backward);\r\n        }\r\n        if (switchOptions.callbacks && switchOptions.callbacks.addElement) {\r\n          switchOptions.callbacks.addElement(el);\r\n        }\r\n        el.className += addClasses;\r\n        el.setAttribute(\"data-pjax-classes\", addClasses);\r\n        elsToAdd.push(el);\r\n        fragToAppend.appendChild(el);\r\n        animatedElsNumber++;\r\n        on(el, animationEventNames, sexyAnimationEnd, true);\r\n      }\r\n    });\r\n\r\n    // pass all className of the parent\r\n    oldEl.className = newEl.className;\r\n    oldEl.appendChild(fragToAppend);\r\n\r\n    // oldEl.style.height = relevantHeight + \"px\"\r\n  }\r\n};\r\n","import {\r\n  forEachEls\r\n} from './utility';\r\n\r\nimport defaultSwitches from \"./switches\";\r\n\r\nexport default function () {\r\n  return (switches, switchesOptions, selectors, fromEl, toEl, options) => {\r\n    selectors.forEach((selector) => {\r\n      const newEls = fromEl.querySelectorAll(selector);\r\n      const oldEls = toEl.querySelectorAll(selector);\r\n      this.log.log(\"Pjax switch\", selector, newEls, oldEls);\r\n      if (newEls.length !== oldEls.length) {\r\n        const throwError = options.onDomDiffers(toEl, fromEl);\r\n        if (throwError) {\r\n          throw \"DOM doesnâ€™t look the same on new loaded page: â€™\" + selector + \"â€™ - new \" + newEls.length + \", old \" + oldEls.length;\r\n        }\r\n      }\r\n\r\n      forEachEls(newEls, function (newEl, i) {\r\n        let oldEl = oldEls[i];\r\n        if(oldEl == undefined) { return; }\r\n        this.log.log(\"newEl\", newEl, \"oldEl\", oldEl);\r\n        if (switches[selector]) {\r\n          switches[selector].call(this, oldEl, newEl, options, switchesOptions[selector]);\r\n        } else {\r\n          defaultSwitches.outerHTML.call(this, oldEl, newEl, options);\r\n        }\r\n      }, this);\r\n    });\r\n  };\r\n}\r\n","if (!Function.prototype.bind) {\r\n  Function.prototype.bind = function(oThis) {\r\n    if (typeof this !== \"function\") {\r\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\r\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\r\n    }\r\n\r\n    var aArgs = Array.prototype.slice.call(arguments, 1);\r\n    var that = this;\r\n    var Fnoop = function() {};\r\n    var fBound = function() {\r\n      return that.apply(this instanceof Fnoop && oThis ? this : oThis, aArgs.concat(Array.prototype.slice.call(arguments)));\r\n    };\r\n\r\n    Fnoop.prototype = this.prototype;\r\n    fBound.prototype = new Fnoop();\r\n\r\n    return fBound;\r\n  };\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport on from \"../events/on\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\n\r\nconst attrClick = \"data-pjax-click-state\";\r\nconst attrKey = \"data-pjax-keyup-state\";\r\n\r\nconst linkAction = function (el, event) {\r\n  // Donâ€™t break browser special behavior on links (like page in new window)\r\n  if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n    el.setAttribute(attrClick, \"modifier\");\r\n    return;\r\n  }\r\n\r\n  // we do test on href now to prevent unexpected behavior if for some reason\r\n  // user have href that can be dynamically updated\r\n\r\n  // Ignore external links.\r\n  if (el.protocol !== window.location.protocol || el.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return;\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (el.pathname === window.location.pathname && el.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return;\r\n  }\r\n\r\n  // Ignore anchors on the same page (keep native behavior)\r\n  if (el.hash && el.href.replace(el.hash, \"\") === window.location.href.replace(location.hash, \"\")) {\r\n    el.setAttribute(attrClick, \"anchor\");\r\n    return;\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (el.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault();\r\n\r\n  // donâ€™t do \"nothing\" if user try to reload the page by clicking the same link twice\r\n  if (\r\n    this.options.currentUrlFullReload &&\r\n    el.href === window.location.href.split(\"#\")[0]\r\n  ) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    this.reload();\r\n    return;\r\n  }\r\n  this.options.requestOptions = this.options.requestOptions || {};\r\n  el.setAttribute(attrClick, \"load\");\r\n  this.loadUrl(el.href, clone(this.options));\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\nexport default function () {\r\n  return (el) => {\r\n\r\n    on(el, \"click\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      linkAction.call(this, el, event);\r\n    });\r\n\r\n    on(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      // Donâ€™t break browser special behavior on links (like page in new window)\r\n      if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n        el.setAttribute(attrKey, \"modifier\");\r\n        return;\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        linkAction.call(this, el, event);\r\n      }\r\n    });\r\n  };\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport on from \"../events/on\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\nconst attrClick = \"data-pjax-submit-state\";\r\n\r\nconst formAction = function (el, event) {\r\n\r\n  this.options.requestOptions = {\r\n    requestUrl: el.getAttribute('action') || window.location.href,\r\n    requestMethod: el.getAttribute('method') || 'GET',\r\n  };\r\n\r\n  //create a testable virtual link of the form action\r\n  const virtLinkElement = document.createElement('a');\r\n  virtLinkElement.setAttribute('href', this.options.requestOptions.requestUrl);\r\n\r\n  // Ignore external links.\r\n  if (virtLinkElement.protocol !== window.location.protocol || virtLinkElement.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return;\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (virtLinkElement.pathname === window.location.pathname && virtLinkElement.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return;\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (virtLinkElement.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\");\r\n    return;\r\n  }\r\n\r\n  // if declared as a full reload, just normally submit the form\r\n  if (this.options.currentUrlFullReload) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault();\r\n  const nameList = [];\r\n  const paramObject = [];\r\n\r\n  for (let elementKey in el.elements) {\r\n    const element = el.elements[elementKey];\r\n    if (!!element.name && element.attributes !== undefined && element.tagName.toLowerCase() !== 'button') {\r\n      if ((element.type !== 'checkbox' && element.type !== 'radio') || element.checked) {\r\n        if (nameList.indexOf(element.name) === -1) {\r\n          nameList.push(element.name);\r\n\r\n          if (String(element.nodeName).toLowerCase() === 'select' && element.multiple == true) {\r\n            const selected = Array.from(element.options).map(item => (item.selected ? item.value : null));\r\n            paramObject.push({\r\n              name: encodeURIComponent(element.name),\r\n              value: selected\r\n            });\r\n            return;\r\n          }\r\n          paramObject.push({\r\n            name: encodeURIComponent(element.name),\r\n            value: encodeURIComponent(element.value)\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  //Creating a getString\r\n  const paramsString = (paramObject.map(value => value.name + \"=\" + value.value)).join('&');\r\n\r\n  this.options.requestOptions.requestPayload = paramObject;\r\n  this.options.requestOptions.requestPayloadString = paramsString;\r\n\r\n  el.setAttribute(attrClick, \"submit\");\r\n\r\n  this.loadUrl(virtLinkElement.href, clone(this.options));\r\n\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\n\r\nexport default function () {\r\n  return (el) => {\r\n    on(el, \"submit\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      formAction.call(this, el, event);\r\n    });\r\n  };\r\n}\r\n","(function (root) {\n\n  // Store setTimeout reference so promise-polyfill will be unaffected by\n  // other code modifying setTimeout (like sinon.useFakeTimers())\n  var setTimeoutFunc = setTimeout;\n\n  function noop() {}\n  \n  // Polyfill for Function.prototype.bind\n  function bind(fn, thisArg) {\n    return function () {\n      fn.apply(thisArg, arguments);\n    };\n  }\n\n  function Promise(fn) {\n    if (!(this instanceof Promise)) throw new TypeError('Promises must be constructed via new');\n    if (typeof fn !== 'function') throw new TypeError('not a function');\n    this._state = 0;\n    this._handled = false;\n    this._value = undefined;\n    this._deferreds = [];\n\n    doResolve(fn, this);\n  }\n\n  function handle(self, deferred) {\n    while (self._state === 3) {\n      self = self._value;\n    }\n    if (self._state === 0) {\n      self._deferreds.push(deferred);\n      return;\n    }\n    self._handled = true;\n    Promise._immediateFn(function () {\n      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n      if (cb === null) {\n        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n        return;\n      }\n      var ret;\n      try {\n        ret = cb(self._value);\n      } catch (e) {\n        reject(deferred.promise, e);\n        return;\n      }\n      resolve(deferred.promise, ret);\n    });\n  }\n\n  function resolve(self, newValue) {\n    try {\n      // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n      if (newValue === self) throw new TypeError('A promise cannot be resolved with itself.');\n      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n        var then = newValue.then;\n        if (newValue instanceof Promise) {\n          self._state = 3;\n          self._value = newValue;\n          finale(self);\n          return;\n        } else if (typeof then === 'function') {\n          doResolve(bind(then, newValue), self);\n          return;\n        }\n      }\n      self._state = 1;\n      self._value = newValue;\n      finale(self);\n    } catch (e) {\n      reject(self, e);\n    }\n  }\n\n  function reject(self, newValue) {\n    self._state = 2;\n    self._value = newValue;\n    finale(self);\n  }\n\n  function finale(self) {\n    if (self._state === 2 && self._deferreds.length === 0) {\n      Promise._immediateFn(function() {\n        if (!self._handled) {\n          Promise._unhandledRejectionFn(self._value);\n        }\n      });\n    }\n\n    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n      handle(self, self._deferreds[i]);\n    }\n    self._deferreds = null;\n  }\n\n  function Handler(onFulfilled, onRejected, promise) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.promise = promise;\n  }\n\n  /**\n   * Take a potentially misbehaving resolver function and make sure\n   * onFulfilled and onRejected are only called once.\n   *\n   * Makes no guarantees about asynchrony.\n   */\n  function doResolve(fn, self) {\n    var done = false;\n    try {\n      fn(function (value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      }, function (reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      });\n    } catch (ex) {\n      if (done) return;\n      done = true;\n      reject(self, ex);\n    }\n  }\n\n  Promise.prototype['catch'] = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n\n  Promise.prototype.then = function (onFulfilled, onRejected) {\n    var prom = new (this.constructor)(noop);\n\n    handle(this, new Handler(onFulfilled, onRejected, prom));\n    return prom;\n  };\n\n  Promise.all = function (arr) {\n    return new Promise(function (resolve, reject) {\n      if (!arr || typeof arr.length === 'undefined') throw new TypeError('Promise.all accepts an array');\n      var args = Array.prototype.slice.call(arr);\n      if (args.length === 0) return resolve([]);\n      var remaining = args.length;\n\n      function res(i, val) {\n        try {\n          if (val && (typeof val === 'object' || typeof val === 'function')) {\n            var then = val.then;\n            if (typeof then === 'function') {\n              then.call(val, function (val) {\n                res(i, val);\n              }, reject);\n              return;\n            }\n          }\n          args[i] = val;\n          if (--remaining === 0) {\n            resolve(args);\n          }\n        } catch (ex) {\n          reject(ex);\n        }\n      }\n\n      for (var i = 0; i < args.length; i++) {\n        res(i, args[i]);\n      }\n    });\n  };\n\n  Promise.resolve = function (value) {\n    if (value && typeof value === 'object' && value.constructor === Promise) {\n      return value;\n    }\n\n    return new Promise(function (resolve) {\n      resolve(value);\n    });\n  };\n\n  Promise.reject = function (value) {\n    return new Promise(function (resolve, reject) {\n      reject(value);\n    });\n  };\n\n  Promise.race = function (values) {\n    return new Promise(function (resolve, reject) {\n      for (var i = 0, len = values.length; i < len; i++) {\n        values[i].then(resolve, reject);\n      }\n    });\n  };\n\n  // Use polyfill for setImmediate for performance gains\n  Promise._immediateFn = (typeof setImmediate === 'function' && function (fn) { setImmediate(fn); }) ||\n    function (fn) {\n      setTimeoutFunc(fn, 0);\n    };\n\n  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n    if (typeof console !== 'undefined' && console) {\n      console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n    }\n  };\n\n  /**\n   * Set the immediate function to execute callbacks\n   * @param fn {function} Function to execute\n   * @deprecated\n   */\n  Promise._setImmediateFn = function _setImmediateFn(fn) {\n    Promise._immediateFn = fn;\n  };\n\n  /**\n   * Change the function to execute on unhandled rejection\n   * @param {function} fn Function to execute on unhandled rejection\n   * @deprecated\n   */\n  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n    Promise._unhandledRejectionFn = fn;\n  };\n  \n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = Promise;\n  } else if (!root.Promise) {\n    root.Promise = Promise;\n  }\n\n})(this);\n","import 'promise-polyfill';\r\n\r\nexport default function (el) {\r\n\r\n  const querySelector = this.options.mainScriptElement;\r\n  const code = (el.text || el.textContent || el.innerHTML || \"\");\r\n\r\n  this.log.log(\"Evaluating Script: \", el);\r\n  if (code.match(\"document.write\")) {\r\n    if (console && this.options.logObject.log) {\r\n      this.options.logObject.log(\"Script contains document.write. Canâ€™t be executed correctly. Code skipped \", el);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  const src = (el.src || \"\");\r\n  const parent = el.parentNode || document.querySelector(querySelector) || document.documentElement;\r\n  const script = document.createElement(\"script\");\r\n\r\n  const promise = new Promise((resolve) => {\r\n    script.type = \"text/javascript\";\r\n    if (src != \"\") {\r\n      script.src = src;\r\n      script.addEventListener('load', function () {\r\n        resolve(src);\r\n      });\r\n      script.async = true; // force asynchronous loading of peripheral js\r\n    }\r\n\r\n    if (code != \"\") {\r\n      try {\r\n        script.appendChild(document.createTextNode(code));\r\n      } catch (e) {\r\n        // old IEs have funky script nodes\r\n        script.text = code;\r\n      }\r\n      resolve('text-node');\r\n    }\r\n  });\r\n\r\n  this.log.log('ParentElement => ', parent);\r\n\r\n  // execute\r\n  parent.appendChild(script);\r\n  parent.removeChild(script);\r\n  // avoid pollution only in head or body tags\r\n  // of if the setting removeScriptsAfterParsing is active\r\n  if (([\"head\", \"body\"].indexOf(parent.tagName.toLowerCase()) > 0) || (this.options.removeScriptsAfterParsing === true)) {\r\n      //Removed this because not necessary in our setup\r\n  }\r\n\r\n  return promise;\r\n}\r\n","import {\r\n  forEachEls\r\n} from \"./utility\";\r\n\r\nimport evalScript from \"./eval-script\";\r\n\r\n// Finds and executes scripts (used for newly added elements)\r\n// Needed since innerHTML does not run scripts\r\nexport default function () {\r\n  return (el) => {\r\n    this.log.log(\"Executing scripts for \", el);\r\n\r\n    const loadingScripts = [];\r\n\r\n    if (el === undefined) return Promise.resolve();\r\n\r\n    if (el.tagName.toLowerCase() === \"script\") {\r\n      evalScript.call(this, el);\r\n    }\r\n\r\n    forEachEls(el.querySelectorAll(\"script\"), (script) => {\r\n      if (!script.type || script.type.toLowerCase() === \"text/javascript\") {\r\n        if (!(script.parentNode && script.parentNode.tagName == 'textarea')) {\r\n            loadingScripts.push(evalScript.call(this, script));\r\n        }\r\n      }\r\n    }, this);\r\n\r\n    return loadingScripts;\r\n  };\r\n};\r\n","import {forEachEls} from \"../utility\";\r\n\r\nexport default function(els, events, listener, useCapture) {\r\n  events = (typeof events === \"string\" ? events.split(\" \") : events);\r\n\r\n  events.forEach(function(e) {\r\n    forEachEls(els, function(el) {\r\n      el.removeEventListener(e, listener, useCapture);\r\n    });\r\n  });\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport off from \"../events/off\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\n\r\nconst attrClick = \"data-pjax-click-state\";\r\nconst attrKey = \"data-pjax-keyup-state\";\r\n\r\nconst linkAction = function (el, event) {\r\n  // Donâ€™t break browser special behavior on links (like page in new window)\r\n  if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n    el.setAttribute(attrClick, \"modifier\");\r\n    return;\r\n  }\r\n\r\n  // we do test on href now to prevent unexpected behavior if for some reason\r\n  // user have href that can be dynamically updated\r\n\r\n  // Ignore external links.\r\n  if (el.protocol !== window.location.protocol || el.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return;\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (el.pathname === window.location.pathname && el.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return;\r\n  }\r\n\r\n  // Ignore anchors on the same page (keep native behavior)\r\n  if (el.hash && el.href.replace(el.hash, \"\") === window.location.href.replace(location.hash, \"\")) {\r\n    el.setAttribute(attrClick, \"anchor\");\r\n    return;\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (el.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault();\r\n\r\n  // donâ€™t do \"nothing\" if user try to reload the page by clicking the same link twice\r\n  if (\r\n    this.options.currentUrlFullReload &&\r\n    el.href === window.location.href.split(\"#\")[0]\r\n  ) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    this.reload();\r\n    return;\r\n  }\r\n  this.options.requestOptions = this.options.requestOptions || {};\r\n  el.setAttribute(attrClick, \"load\");\r\n  this.loadUrl(el.href, clone(this.options));\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\nexport default function () {\r\n  return (el) => {\r\n    off(el, \"click\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      linkAction.call(this, el, event);\r\n    });\r\n\r\n    off(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      // Donâ€™t break browser special behavior on links (like page in new window)\r\n      if (event.which > 1 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\r\n        el.setAttribute(attrKey, \"modifier\");\r\n        return;\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        linkAction.call(this, el, event);\r\n      }\r\n    });\r\n  };\r\n}\r\n","import \"../polyfills/Function.prototype.bind\";\r\n\r\nimport off from \"../events/off\";\r\nimport {\r\n  clone\r\n} from \"../utility\";\r\n\r\nconst attrClick = \"data-pjax-click-state\";\r\n\r\nconst formAction = function (el, event) {\r\n\r\n  this.options.requestOptions = {\r\n    requestUrl: el.getAttribute('action') || window.location.href,\r\n    requestMethod: el.getAttribute('method') || 'GET',\r\n  };\r\n\r\n  //create a testable virtual link of the form action\r\n  var virtLinkElement = document.createElement('a');\r\n  virtLinkElement.setAttribute('href', this.options.requestOptions.requestUrl);\r\n\r\n  // Ignore external links.\r\n  if (virtLinkElement.protocol !== window.location.protocol || virtLinkElement.host !== window.location.host) {\r\n    el.setAttribute(attrClick, \"external\");\r\n    return;\r\n  }\r\n\r\n  // Ignore click if we are on an anchor on the same page\r\n  if (virtLinkElement.pathname === window.location.pathname && virtLinkElement.hash.length > 0) {\r\n    el.setAttribute(attrClick, \"anchor-present\");\r\n    return;\r\n  }\r\n\r\n  // Ignore empty anchor \"foo.html#\"\r\n  if (virtLinkElement.href === window.location.href.split(\"#\")[0] + \"#\") {\r\n    el.setAttribute(attrClick, \"anchor-empty\");\r\n    return;\r\n  }\r\n\r\n  // if declared as a full reload, just normally submit the form\r\n  if (this.options.currentUrlFullReload) {\r\n    el.setAttribute(attrClick, \"reload\");\r\n    return;\r\n  }\r\n\r\n  event.preventDefault();\r\n  const nameList = [];\r\n  const paramObject = [];\r\n  for (let elementKey in el.elements) {\r\n    const element = el.elements[elementKey];\r\n    if (!!element.name && element.attributes !== undefined && element.tagName.toLowerCase() !== 'button') {\r\n      if (\r\n        (element.type !== 'checkbox' && element.type !== 'radio') || element.checked\r\n      ) {\r\n        if (nameList.indexOf(element.name) === -1) {\r\n          nameList.push(element.name);\r\n          paramObject.push({\r\n            name: encodeURIComponent(element.name),\r\n            value: encodeURIComponent(element.value)\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  //Creating a getString\r\n  const paramsString = (paramObject.map(value => value.name + \"=\" + value.value)).join('&');\r\n\r\n  this.options.requestOptions.requestPayload = paramObject;\r\n  this.options.requestOptions.requestPayloadString = paramsString;\r\n\r\n  el.setAttribute(attrClick, \"submit\");\r\n\r\n  this.loadUrl(virtLinkElement.href, clone(this.options));\r\n\r\n};\r\n\r\nconst isDefaultPrevented = function (event) {\r\n  return event.defaultPrevented || event.returnValue === false;\r\n};\r\n\r\n\r\nexport default function () {\r\n  return (el) => {\r\n\r\n    off(el, \"submit\", function (event) {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      formAction.call(this, el, event);\r\n    });\r\n\r\n    off(el, \"keyup\", (event) => {\r\n      if (isDefaultPrevented(event)) {\r\n        return;\r\n      }\r\n\r\n      if (event.keyCode == 13) {\r\n        formAction.call(this, el, event);\r\n      }\r\n    });\r\n  };\r\n}\r\n","import './polyfills/Array.prototype.from';\r\nimport {\r\n  forEachEls\r\n} from './utility';\r\nexport default function () {\r\n  return (elements, oldElements) => {\r\n    this.log.log(\"styleheets old elements\", oldElements);\r\n    this.log.log(\"styleheets new elements\", elements);\r\n\r\n    forEachEls(elements, (newEl) => {\r\n\r\n      const resemblingOld = Array.from(oldElements).reduce((acc, oldEl) => {\r\n        acc = ((oldEl.href === newEl.href) ? oldEl : acc);\r\n        return acc;\r\n      }, null);\r\n\r\n      if (resemblingOld !== null) {\r\n        if (this.log) {\r\n          this.log.log(\"old stylesheet found not resetting\");\r\n        }\r\n      } else {\r\n        if (this.log) {\r\n          this.log.log(\"new stylesheet => add to head\");\r\n        }\r\n        const head = document.getElementsByTagName('head')[0];\r\n        const link = document.createElement('link');\r\n\r\n        link.setAttribute('href', newEl.href);\r\n        link.setAttribute('rel', 'stylesheet');\r\n        link.setAttribute('type', 'text/css');\r\n        head.appendChild(link);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/**\r\n * Collection of parsing methods\r\n *  Exports:\r\n *  -> parseDOMUnload\r\n *  -> parseDOM\r\n *  -> parseElementUnload\r\n *  -> parseElement\r\n *  -> parseOptions\r\n */\r\n\r\nimport {\r\n  forEachEls\r\n} from \"../utility\";\r\n\r\n\r\n\r\nexport default function () {\r\n  return {\r\n    parseElementUnload: function (el) {\r\n      switch (el.tagName.toLowerCase()) {\r\n        case \"a\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.unattachLink(el);\r\n          }\r\n          break;\r\n\r\n        case \"form\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.unattachForm(el);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          throw \"Pjax can only be applied on <a> or <form> submit\";\r\n      }\r\n    },\r\n\r\n    parseElement: function (el) {\r\n      switch (el.tagName.toLowerCase()) {\r\n        case \"a\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.attachLink(el);\r\n          }\r\n          break;\r\n\r\n        case \"form\":\r\n          // only attach link if el does not already have link attached\r\n          if (!el.hasAttribute('data-pjax-click-state')) {\r\n            this.attachForm(el);\r\n          }\r\n          break;\r\n\r\n        default:\r\n          throw \"Pjax can only be applied on <a> or <form> submit\";\r\n      }\r\n    },\r\n    parseDOMUnload: function (el) {\r\n      forEachEls(this.getElements(el), this.parseElementUnload, this);\r\n    },\r\n\r\n    parseDOM: function (el) {\r\n      forEachEls(this.getElements(el), this.parseElement, this);\r\n    },\r\n\r\n    parseOptions: function (options) {\r\n      this.options = options;\r\n\r\n      this.options.elements = this.options.elements || \"a[href], form[action]\";\r\n      this.options.reRenderCSS = this.options.reRenderCSS || false;\r\n      this.options.forceRedirectOnFail = this.options.forceRedirectOnFail || false;\r\n      this.options.scriptloadtimeout = this.options.scriptloadtimeout || 1000;\r\n      this.options.mainScriptElement = this.options.mainScriptElement || \"head\";\r\n      this.options.removeScriptsAfterParsing = this.options.removeScriptsAfterParsing || true;\r\n      this.options.logObject = this.options.logObject || console;\r\n      this.options.latestChance = this.options.latestChance || null;\r\n      this.options.selectors = this.options.selectors || [\"title\", \".js-Pjax\"];\r\n      this.options.switches = this.options.switches || {};\r\n      this.options.switchesOptions = this.options.switchesOptions || {};\r\n      this.options.history = this.options.history || true;\r\n      this.options.onDomDiffers = this.options.onDomDiffers || (() => true);\r\n      this.options.pjaxErrorHandler = this.options.pjaxErrorHandler || (() => false);\r\n      this.options.onJsonDocument = this.options.onJsonDocument || (() => true);\r\n      this.options.analytics = this.options.analytics || (() => {\r\n        // options.backward or options.foward can be true or undefined\r\n        // by default, we do track back/foward hit\r\n        // https://productforums.google.com/forum/#!topic/analytics/WVwMDjLhXYk\r\n        if (window._gaq) {\r\n          window._gaq.push([\"_trackPageview\"]);\r\n        }\r\n        if (window.ga) {\r\n          window.ga(\"send\", \"pageview\", {\r\n            page: location.pathname,\r\n            title: document.title\r\n          });\r\n        }\r\n      });\r\n      this.options.scrollTo = (typeof this.options.scrollTo === 'undefined') ? 0 : this.options.scrollTo;\r\n      this.options.cacheBust = (typeof this.options.cacheBust === 'undefined') ? true : this.options.cacheBust;\r\n      this.options.debug = this.options.debug || false;\r\n\r\n      // we canâ€™t replace body.outerHTML or head.outerHTML\r\n      // it create a bug where new body or new head are created in the dom\r\n      // if you set head.outerHTML, a new body tag is appended, so the dom get 2 body\r\n      // & it break the switchFallback which replace head & body\r\n      if (!this.options.switches.head) {\r\n        this.options.switches.head = this.switchElementsAlt;\r\n      }\r\n      if (!this.options.switches.body) {\r\n        this.options.switches.body = this.switchElementsAlt;\r\n      }\r\n      if (typeof options.analytics !== \"function\") {\r\n        options.analytics = function () {};\r\n      }\r\n    }\r\n  };\r\n}\r\n","/**\r\n * Exports\r\n *  -> refresh\r\n *  -> reload\r\n *  -> foreachSelectors\r\n *  -> unattach\r\n */\r\nimport {\r\n  forEachEls\r\n} from './utility';\r\nimport off from \"./events/off\";\r\nexport default function () {\r\n  return {\r\n    refresh: (el) => {\r\n      this.parseDOM(el || document);\r\n    },\r\n\r\n    reload: function () {\r\n      window.location.reload();\r\n    },\r\n\r\n    foreachSelectors: (selectors, cb, context, DOMcontext) => {\r\n      DOMcontext = DOMcontext || document;\r\n      selectors.forEach(function (selector) {\r\n        forEachEls(DOMcontext.querySelectorAll(selector), cb, context);\r\n      });\r\n    },\r\n\r\n    unattach: (el) => {\r\n      forEachEls(this.getElements(el), (el) => {\r\n        off(el, 'click');\r\n        off(el, 'keyup');\r\n      }, this);\r\n    }\r\n  };\r\n}\r\n","\"use strict\";\r\n\r\nimport on from \"./lib/events/on.js\";\r\nimport log from \"./lib/proto/log.js\";\r\nimport trigger from \"./lib/events/trigger.js\";\r\nimport doRequest from \"./lib/request.js\";\r\nimport getSwitchSelectors from './lib/switches-selectors.js';\r\nimport getAttachLink from \"./lib/proto/attach-link.js\";\r\nimport getAttachForm from \"./lib/proto/attach-form.js\";\r\nimport getExecuteScripts from './lib/execute-scripts.js';\r\nimport getUnattachLink from \"./lib/proto/unattach-link.js\";\r\nimport getUnattachForm from \"./lib/proto/unattach-form.js\";\r\nimport getUpdateStylesheets from \"./lib/update-stylesheets.js\";\r\nimport getUtility from './lib/utility.js';\r\nimport {isSupported} from './lib/utility.js';\r\nimport getParsers from \"./lib/proto/parsers.js\";\r\nimport getDomUtils from \"./lib/domutil.js\";\r\n\r\nconst PjaxFactory = function () {\r\n\r\n  class Pjax {\r\n\r\n    constructor(options) {\r\n      this.firstrun = true;\r\n      this.oUtilities = getUtility();\r\n      this.oDomUtils = getDomUtils.call(this);\r\n      this.oParsers = getParsers.call(this);\r\n      \r\n      this.oParsers.parseOptions.call(this, options);\r\n      this.log = log.call(this);\r\n\r\n      this.doRequest = doRequest;\r\n      this.getElements = this.oUtilities.getElements;\r\n      this.parseElementUnload = this.oParsers.parseElementUnload;\r\n      this.parseElement = this.oParsers.parseElement;\r\n      this.parseDOM = this.oParsers.parseDOM;\r\n      this.parseDOMUnload = this.oParsers.parseDOMUnload;\r\n      this.refresh = this.oDomUtils.refresh;\r\n      this.reload = this.oDomUtils.reload;\r\n      this.isSupported = this.oUtilities.isSupported;\r\n      this.attachLink = getAttachLink.call(this);\r\n      this.attachForm = getAttachForm.call(this);\r\n      this.unattachLink = getUnattachLink.call(this);\r\n      this.unattachForm = getUnattachForm.call(this);\r\n      this.updateStylesheets = getUpdateStylesheets.call(this);\r\n\r\n  \r\n\r\n      this.log.log(\"Pjax options\", this.options);\r\n      this.maxUid = this.lastUid = this.oUtilities.newUid();\r\n      this.parseDOM(document);\r\n\r\n      on(window, \"popstate\", (st) => {\r\n        this.log.log(\"OPT -> \", st);\r\n\r\n        if (st.state) {\r\n          const opt = this.oUtilities.clone(this.options);\r\n\r\n          opt.url = st.state.url;\r\n          opt.title = st.state.title;\r\n          opt.history = false;\r\n          opt.requestOptions = {};\r\n            \r\n            this.log.log(\"OPT -> \", opt);\r\n            this.log.log(\"State UID\", st.state.uid);\r\n            this.log.log(\"lastUID\", this.lastUid);\r\n\r\n          if (st.state.uid < this.lastUid) {\r\n            opt.backward = true;\r\n          } else {\r\n            opt.forward = true;\r\n          }\r\n          this.lastUid = st.state.uid;\r\n\r\n          // @todo implement history cache here, based on uid\r\n          this.loadUrl(st.state.url, opt);\r\n        }\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n\r\n    forEachSelectors(cb, context, DOMcontext) {\r\n      return this.oDomUtils.foreachSelectors(this.options.selectors, cb, context, DOMcontext);\r\n    }\r\n\r\n    switchSelectors(selectors, fromEl, toEl, options) {\r\n      const fnSwitchSelectors = getSwitchSelectors.call(this);\r\n      return fnSwitchSelectors(this.options.switches, this.options.switchesOptions, selectors, fromEl, toEl, options);\r\n    }\r\n\r\n\r\n    latestChance(href) {\r\n      window.location.href = href;\r\n      return false;\r\n    }\r\n\r\n    onSwitch() {\r\n      trigger(window, \"resize scroll\");\r\n    }\r\n\r\n    loadContent(html, options) {\r\n      const fnExecuteScripts = getExecuteScripts.apply(this);\r\n      const tmpEl = window.document.implementation.createHTMLDocument(\"pjax\");\r\n      //Collector array to store the promises in\r\n      const collectForScriptcomplete = [(Promise.resolve(\"basic resolve\"))];\r\n\r\n      //parse HTML attributes to copy them\r\n      //since we are forced to use documentElement.innerHTML (outerHTML can't be used for <html>)\r\n      const htmlRegex = /<html[^>]+>/gi;\r\n      const htmlAttribsRegex = /\\s?[a-z:]+(?:=(?:'|\")[^'\">]+(?:'|\"))*/gi;\r\n\r\n      let matches = html.match(htmlRegex);\r\n      if (matches && matches.length) {\r\n        matches = matches[0].match(htmlAttribsRegex);\r\n        if (matches.length) {\r\n          matches.shift();\r\n          matches.forEach(function (htmlAttrib) {\r\n            var attr = htmlAttrib.trim().split(\"=\");\r\n            if (attr.length === 1) {\r\n              tmpEl.documentElement.setAttribute(attr[0], true);\r\n            } else {\r\n              tmpEl.documentElement.setAttribute(attr[0], attr[1].slice(1, -1));\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      let jsonContent = null;\r\n      try {\r\n        jsonContent = JSON.parse(html);\r\n      } catch (e) {\r\n        this.log.warn('No JSON found. If you expected it there was an error');\r\n      }\r\n\r\n      tmpEl.documentElement.innerHTML = html;\r\n      this.log.log(\"load content\", tmpEl.documentElement.attributes, tmpEl.documentElement.innerHTML.length);\r\n\r\n      if (jsonContent !== null) {\r\n        this.log.log(\"found JSON document\", jsonContent);\r\n        this.options.onJsonDocument.call(this, jsonContent);\r\n      }\r\n\r\n      // Clear out any focused controls before inserting new page contents.\r\n      // we clear focus on non form elements\r\n      if (window.document.activeElement && !window.document.activeElement.value) {\r\n        try {\r\n          window.document.activeElement.blur();\r\n        } catch (e) {\r\n          // Nothing to do, just ignore any issues\r\n        }\r\n      }\r\n\r\n      this.switchSelectors(this.options.selectors, tmpEl, document, options);\r\n\r\n      //reset stylesheets if activated\r\n      if (this.options.reRenderCSS === true) {\r\n        this.updateStylesheets(tmpEl.querySelectorAll('link[rel=stylesheet]'), document.querySelectorAll('link[rel=stylesheet]'));\r\n      }\r\n\r\n      // FF bug: Wonâ€™t autofocus fields that are inserted via JS.\r\n      // This behavior is incorrect. So if theres no current focus, autofocus\r\n      // the last field.\r\n      //\r\n      // http://www.w3.org/html/wg/drafts/html/master/forms.html\r\n      const autofocusEl = Array.prototype.slice.call(document.querySelectorAll(\"[autofocus]\")).pop();\r\n      if (autofocusEl && document.activeElement !== autofocusEl) {\r\n        autofocusEl.focus();\r\n      }\r\n\r\n      // execute scripts when DOM have been completely updated\r\n      this.options.selectors.forEach((selector) => {\r\n        this.oUtilities.forEachEls(document.querySelectorAll(selector), function (el) {\r\n          collectForScriptcomplete.push.apply(collectForScriptcomplete, fnExecuteScripts(el));\r\n        }, this);\r\n      });\r\n      // }\r\n      // catch(e) {\r\n      //   if (this.options.debug) {\r\n      //     this.log.log(\"Pjax switch fail: \", e)\r\n      //   }\r\n      //   this.switchFallback(tmpEl, document)\r\n      // }\r\n      this.log.log(\"waiting for scriptcomplete\", collectForScriptcomplete);\r\n\r\n      //Fallback! If something can't be loaded or is not loaded correctly -> just force eventing in error\r\n      let timeOutScriptEvent = null;\r\n      timeOutScriptEvent = window.setTimeout(function () {\r\n        trigger(document, \"pjax:scriptcomplete pjax:scripttimeout\", options);\r\n        timeOutScriptEvent = null;\r\n      }, this.options.scriptloadtimeout);\r\n\r\n      Promise.all(collectForScriptcomplete).then(\r\n        //resolved\r\n        function () {\r\n          if (timeOutScriptEvent !== null) {\r\n            window.clearTimeout(timeOutScriptEvent);\r\n            trigger(document, \"pjax:scriptcomplete pjax:scriptsuccess\", options);\r\n          }\r\n        },\r\n        function () {\r\n          if (timeOutScriptEvent !== null) {\r\n            window.clearTimeout(timeOutScriptEvent);\r\n            trigger(document, \"pjax:scriptcomplete pjax:scripterror\", options);\r\n          }\r\n        }\r\n      );\r\n    }\r\n\r\n    loadUrl(href, options) {\r\n      this.log.log(\"load href\", href, options);\r\n\r\n      trigger(document, \"pjax:send\", options);\r\n\r\n      // Do the request\r\n      this.doRequest(href, options.requestOptions, (html, requestData) => {\r\n        // Fail if unable to load HTML via AJAX\r\n        if (html === false || requestData.status !== 200) {\r\n          trigger(document, \"pjax:complete pjax:error\", {\r\n            options: options,\r\n            requestData: requestData,\r\n            href: href\r\n          });\r\n          return options.pjaxErrorHandler(href, options, requestData);\r\n        }\r\n\r\n        // Clear out any focused controls before inserting new page contents.\r\n        document.activeElement.blur();\r\n\r\n        try {\r\n          this.loadContent(html, options);\r\n        } catch (e) {\r\n          if (!this.options.debug) {\r\n            if (console && this.options.logObject.error) {\r\n              this.options.logObject.error(\"Pjax switch fail: \", e);\r\n            }\r\n            return options.pjaxErrorHandler(href, options, requestData) || this.latestChance(href);\r\n          } else {\r\n            if (this.options.forceRedirectOnFail) {\r\n              return options.pjaxErrorHandler(href, options, requestData) || this.latestChance(href);\r\n            }\r\n            throw e;\r\n          }\r\n        }\r\n\r\n        if (options.history) {\r\n          if (this.firstrun) {\r\n            this.lastUid = this.maxUid = this.oUtilities.newUid();\r\n            this.firstrun = false;\r\n            window.history.replaceState({\r\n                url: window.location.href,\r\n                title: document.title,\r\n                uid: this.maxUid\r\n              },\r\n              document.title);\r\n          }\r\n\r\n          // Update browser history\r\n          this.lastUid = this.maxUid = this.oUtilities.newUid();\r\n          window.history.pushState({\r\n              url: href,\r\n              title: options.title,\r\n              uid: this.maxUid\r\n            },\r\n            options.title,\r\n            href);\r\n        }\r\n\r\n        this.forEachSelectors(el => this.parseDOM(el));\r\n\r\n        // Fire Events\r\n        trigger(document, \"pjax:complete pjax:success\", options);\r\n\r\n        options.analytics();\r\n\r\n        // Scroll page to top on new page load\r\n        if (options.scrollTo !== false) {\r\n          if (options.scrollTo.length > 1) {\r\n            window.scrollTo(options.scrollTo[0], options.scrollTo[1]);\r\n          } else {\r\n            window.scrollTo(0, options.scrollTo);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  // if there isnâ€™t required browser functions, returning stupid api\r\n  if (!isSupported()) {\r\n      console.warn('Pjax not supported');\r\n    const stupidPjax = function () {};\r\n    for (let key in Pjax.prototype) {\r\n      if (key in Pjax.prototype && typeof Pjax.prototype[key] === \"function\") {\r\n        stupidPjax[key] = stupidPjax;\r\n      }\r\n    }\r\n    return stupidPjax;\r\n  }\r\n\r\n  return Pjax;\r\n};\r\n\r\nexport default new PjaxFactory();\r\n"],"names":["Array","prototype","from","enumerable","arr","i","length","unshift","forEachEls","els","fn","ctx","HTMLCollection","NodeList","forEach","el","call","getElements","querySelectorAll","options","elements","clone","obj","copy","constructor","attr","isSupported","window","history","pushState","replaceState","navigator","userAgent","match","newUid","counter","id","Date","getTime","events","listener","useCapture","split","e","addEventListener","ConsoleShim","param","silencer","collector","currentGroupDescription","activeGroups","timeHolder","methods","silent","group","groupEnd","log","trace","time","timeEnd","error","err","debug","warn","Error","rawArgs","args","arguments","newValue","_insertParamToArguments","console","apply","description","shift","repeat","artificialError","_generateError","stack","callee","undefined","diff","Math","floor","logObject","opts","event","document","createEvent","initEvent","eventName","Object","keys","key","domFix","parentNode","body","appendChild","dispatchEvent","removeChild","location","callback","requestMethod","requestPayload","requestPayloadString","request","XMLHttpRequest","onreadystatechange","readyState","status","responseText","cacheBust","test","open","toUpperCase","setRequestHeader","send","outerHTML","oldEl","newEl","onSwitch","innerHTML","className","sideBySide","switchOptions","elsToRemove","elsToAdd","fragToAppend","createDocumentFragment","animationEventNames","animatedElsNumber","sexyAnimationEnd","target","currentTarget","replace","getAttribute","removeAttribute","bind","childNodes","push","classList","contains","hasAttribute","add","callbacks","removeElement","classNames","remove","backward","forward","on","addClasses","addElement","setAttribute","switches","switchesOptions","selectors","fromEl","toEl","selector","newEls","oldEls","throwError","onDomDiffers","defaultSwitches","Function","oThis","TypeError","aArgs","slice","that","Fnoop","fBound","concat","attrClick","attrKey","linkAction","which","metaKey","ctrlKey","shiftKey","altKey","protocol","host","pathname","hash","href","preventDefault","currentUrlFullReload","reload","requestOptions","loadUrl","isDefaultPrevented","defaultPrevented","returnValue","keyCode","formAction","requestUrl","virtLinkElement","createElement","nameList","paramObject","elementKey","element","name","attributes","tagName","toLowerCase","type","checked","indexOf","String","nodeName","multiple","selected","map","item","value","encodeURIComponent","paramsString","join","this","querySelector","mainScriptElement","code","text","textContent","src","parent","documentElement","script","promise","Promise","resolve","async","createTextNode","removeScriptsAfterParsing","loadingScripts","evalScript","removeEventListener","off","oldElements","resemblingOld","reduce","acc","head","getElementsByTagName","link","parseElementUnload","unattachLink","unattachForm","parseElement","attachLink","attachForm","parseDOMUnload","parseDOM","parseOptions","reRenderCSS","forceRedirectOnFail","scriptloadtimeout","latestChance","pjaxErrorHandler","onJsonDocument","analytics","_gaq","ga","page","title","scrollTo","switchElementsAlt","refresh","foreachSelectors","cb","context","DOMcontext","unattach","PjaxFactory","Pjax","firstrun","oUtilities","getUtility","oDomUtils","getDomUtils","oParsers","getParsers","doRequest","getAttachLink","getAttachForm","getUnattachLink","getUnattachForm","updateStylesheets","getUpdateStylesheets","maxUid","lastUid","st","state","opt","url","uid","fnSwitchSelectors","getSwitchSelectors","trigger","html","fnExecuteScripts","getExecuteScripts","tmpEl","implementation","createHTMLDocument","collectForScriptcomplete","htmlRegex","htmlAttribsRegex","matches","htmlAttrib","trim","jsonContent","JSON","parse","activeElement","blur","switchSelectors","autofocusEl","pop","focus","timeOutScriptEvent","setTimeout","all","then","clearTimeout","requestData","loadContent","forEachSelectors","stupidPjax"],"mappings":"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"}